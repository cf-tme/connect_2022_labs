<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Cloudflare Images &mdash; cf-connect-2022  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Cloudflare Workers (WIP)" href="lab3.html" />
    <link rel="prev" title="1. Cloudflare Pages" href="lab1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> cf-connect-2022
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pre-Requisites:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="github.html">1. Setup Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">2. Setup Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">3. Setup Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="npm.html">4. Setup Node Package Manager</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lab Exercises:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">1. Cloudflare Pages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Cloudflare Images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#clone-project-connect-kv-store-new-students">2.1. Clone Project &amp; Connect KV Store (New Students)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clone-github-repository">2.1.1. Clone GitHub Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploy-project-to-pages">2.1.2. Deploy project to Pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-images-kv-namespace">2.1.3. Creating an IMAGES KV Namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binding-kv-namespace-to-pages-project">2.1.4. Binding KV Namespace to Pages Project</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#manually-re-deploy-application">2.1.4.1. Manually Re-Deploy Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generate-api-keys-for-account">2.2. Generate API Keys for account</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">3. Cloudflare Workers (WIP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">4. Cloudflare Zero Trust Gateway</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cf-connect-2022</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">2. </span>Cloudflare Images</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lab2.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cloudflare-images">
<h1><span class="section-number">2. </span>Cloudflare Images<a class="headerlink" href="#cloudflare-images" title="Permalink to this headline"></a></h1>
<p>Welcome to Lab 2 at Cloudflare Connect 2022 - This lab will focus on Uploading and Delivering Images via Cloudflare Images
By the end of this lab you will have:</p>
<ul class="simple">
<li><p>Uploaded images to Cloudflare via the API</p></li>
<li><p>Used Image variants</p></li>
<li><p>Seamlessly integrated Cloudflare Images and Pages</p></li>
</ul>
<p>Cloudflare Images provides a straightforward, end-to-end solution to cost-effectively build and maintain your image infrastructure. Store, resize, and optimize images at scale using one unified product.</p>
<div class="note admonition">
<p class="admonition-title">Learn More about Cloudflare Images! </p>
<p>Check out the <a class="reference external" href="https://www.cloudflare.com/products/cloudflare-images/">Cloudflare Homepage</a> to learn more</p>
</div>
<section id="clone-project-connect-kv-store-new-students">
<h2><span class="section-number">2.1. </span>Clone Project &amp; Connect KV Store (New Students)<a class="headerlink" href="#clone-project-connect-kv-store-new-students" title="Permalink to this headline"></a></h2>
<div class="note admonition">
<p class="admonition-title">Already Complete Lab 1?</p>
<p>If you have already completed Lab 1 Skip ahead to this <a class="reference internal" href="#content-references-skip"><span class="std std-ref">section</span></a></p>
</div>
<section id="clone-github-repository">
<h3><span class="section-number">2.1.1. </span>Clone GitHub Repository<a class="headerlink" href="#clone-github-repository" title="Permalink to this headline"></a></h3>
<p>To make things easier we have setup a starter gallery app on GitHub. Lets fork and clone the repository.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gh repo fork cf-tme/connect_2022_lab1_complete
</pre></div>
</div>
<p>This should create a fork of the complete Lab 1 repository in your gh account. Follow the fork with a clone</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gh repo clone &lt;yourgithubusername&gt;/connect_2022_lab1_complete
</pre></div>
</div>
<p>Now all the files should be local in your working directory, let navigate into the repo to start coding!</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;yourgithubusername&gt;/connect_2022_lab1_complete
</pre></div>
</div>
</section>
<section id="deploy-project-to-pages">
<h3><span class="section-number">2.1.2. </span>Deploy project to Pages<a class="headerlink" href="#deploy-project-to-pages" title="Permalink to this headline"></a></h3>
<p>Deploying our GitHub project to pages is as simple as connecting our GitHub account to Cloudflare.</p>
<p>Login to the <a class="reference external" href="https://dash.cloudflare.com">Cloudflare Dashboard</a></p>
<p>Select <strong>Pages</strong> on the left hand side and press <strong>Create a Project</strong> and select <strong>Connect GitHub</strong></p>
<p><img alt="pages" src="_images/pages_gh_setup.png" /></p>
<div class="note admonition">
<p class="admonition-title">Authenticate to GitHub</p>
<p>If you are not already logged into GitHub in your browser you may be asked to re-authenticate</p>
</div>
<p>You will be prompted to <strong>Install and Authorize</strong> Cloudflare Pages to your github account, press the button to proceed.</p>
<p><img alt="linkgh" src="_images/pages_gh_auth.png" /></p>
<p>Once connected you will be brought back to the Cloudflare Pages dashboard. Select <em>connect_2022_lab1</em> on the following page</p>
<p><img alt="linkgh" src="_images/pages_gh_repo_select.png" /></p>
<p>Once selected you will need to configure build parameters. This is build using React so we will set the following build parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Project</span> <span class="n">name</span> <span class="o">-</span> <span class="n">connect_2022_lab1_complete</span>
<span class="n">Production</span> <span class="n">branch</span> <span class="o">-</span> <span class="n">master</span>
<span class="n">Framework</span> <span class="n">preset</span> <span class="o">-</span> <span class="n">Create</span> <span class="n">React</span> <span class="n">App</span>
<span class="n">Build</span> <span class="n">command</span> <span class="o">-</span> <span class="n">npm</span> <span class="n">run</span> <span class="n">build</span>
<span class="n">Build</span> <span class="n">output</span> <span class="n">directory</span> <span class="o">-</span> <span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
<p><img alt="linkgh" src="_images/pages_gh_add.png" /></p>
<p>Press <strong>Deploy</strong></p>
<div class="note admonition">
<p class="admonition-title">Deployment Progress</p>
<p>Once started the deployment will take a few moments to complete - you can follow the deployment details to monitor progress of the deployment.</p>
</div>
<p>Once the deployment has completed you will be presented with a success message as well as a URL to visit your new project Select the <strong>link</strong>.</p>
<div class="note admonition">
<p class="admonition-title">pages.dev Domain</p>
<p>By default new projects will automatically be given a *.pages.dev domain, If you would like to setup custom routes to your own domain you can do that through DNS CNAMEing (or directly in the project settings if your domain nameservers are Cloudflare)</p>
</div>
<p>Before we test out application we need to create and Bind a KV namespace</p>
</section>
<section id="creating-an-images-kv-namespace">
<h3><span class="section-number">2.1.3. </span>Creating an IMAGES KV Namespace<a class="headerlink" href="#creating-an-images-kv-namespace" title="Permalink to this headline"></a></h3>
<p>Our application has been written to read data from env.IMAGES - this means we need to bind our KV namespace to our project with the variable name “IMAGES”</p>
<p>From your Cloudflare account landing page navigate to <strong>Workers &gt; KV</strong></p>
<div class="note admonition">
<p class="admonition-title">Verify Email</p>
<p>If you have not already confirmed your e-mail address for your Cloudflare Account you may be asked to Verify it here before creating any KV namespaces</p>
</div>
<p>Select <strong>Create Namespace</strong> and enter <em>IMAGES</em> in the <em>Namespace Name</em> and press <strong>Add</strong></p>
<p><img alt="kv-name" src="_images/kv-namespace.png" /></p>
<div class="note admonition">
<p class="admonition-title">Namespace ID</p>
<p>Once  your namespace is created you will be given a Namespace ID - this will be needed later on in Lab 2, so if you plan on joining us for Lab 2 go ahead and take note of this id - you can always navigate back to this screen and grab it later if needed.</p>
</div>
</section>
<section id="binding-kv-namespace-to-pages-project">
<h3><span class="section-number">2.1.4. </span>Binding KV Namespace to Pages Project<a class="headerlink" href="#binding-kv-namespace-to-pages-project" title="Permalink to this headline"></a></h3>
<p>Once our Namespace is created we must bind it to our Pages project so that our functions can leverage the data inside.</p>
<div class="note admonition">
<p class="admonition-title">Look Ahead</p>
<p>We will be using this namespace to store Image metadata that will then be read in dynamically update our gallery with images that we upload!</p>
</div>
<p>From the Left hand side navigation pane on the Cloudflare Dashboard select <strong>Pages</strong> then select our project <em>connect_2022_lab1_complete</em></p>
<p>In the top navigation bar select <strong>Settings</strong> and then <strong>Functions</strong> On the left hand side.</p>
<p><img alt="kv-name" src="_images/kv-namespace.png" /></p>
<p>Select <strong>Add binding</strong> under the <em>KV namespace binding</em> (under <em>Production</em> sub-tab)</p>
<p>Enter <em>IMAGES</em> in the Variable name and Select the <em>IMAGES</em> KV namespace from the dropdown. And press <strong>Save</strong></p>
<p><img alt="kv-name" src="_images/save-binding.png" /></p>
<div class="note admonition">
<p class="admonition-title">Manual Re-Deploy</p>
<p>In order for KV binding to take effect we need to rebuild the project - this is generally not an issue when live developing as a git push will force it but in this case to test a few things out we will manual kick off a re-deployment</p>
</div>
<section id="manually-re-deploy-application">
<h4><span class="section-number">2.1.4.1. </span>Manually Re-Deploy Application<a class="headerlink" href="#manually-re-deploy-application" title="Permalink to this headline"></a></h4>
<p>To kick off a manual re-deployment we must first select <em>View build</em> (in the bottom right) on the latest deployment of our application.</p>
<p><img alt="kv-name" src="_images/view-build.png" /></p>
<p>On the following page select <strong>Manage Deployment</strong> in the top right and press <strong>Retry Deployment</strong></p>
<p><img alt="kv-name" src="_images/re-deploy.png" /></p>
<p>This will kickoff a manual deployment, give it a few moments to complete.</p>
<p>Congratulations you are now all caught up! If you navigate to the url that was generated for you Pages project you should see a blank gallery (plain blue page).</p>
</section>
</section>
</section>
<section id="generate-api-keys-for-account">
<span id="content-references-skip"></span><h2><span class="section-number">2.2. </span>Generate API Keys for account<a class="headerlink" href="#generate-api-keys-for-account" title="Permalink to this headline"></a></h2>
<p>Before we can upload images or write values to our KV store with the API We need to generate API keys for our account.</p>
<div class="note admonition">
<p class="admonition-title">Images API Key</p>
<p>Cloudflare Images is a Paid product, for this lab you will be using a shared Images account with provided API keys, in the real world you would swap out the Keys for your own.</p>
</div>
<p>To generate API keys navigate to the <a class="reference external" href="https://dash.cloudflare.com">Cloudflare Dashboard</a>, login and select your user on the top right and select <strong>My Profile</strong></p>
<p><img alt="user" src="_images/select-user.png" /></p>
<p>On the left navigation pane select <strong>API Tokens</strong> and press <strong>Create Token</strong></p>
<p><img alt="token" src="_images/api-token.png" /></p>
<p>Some <strong>text</strong>!</p>
<p>for those of you returning from previous lab go ahead and SKIP to this section</p>
<p>clone the lab 1 complete repository</p>
<p>create a KV namespace called Images
note the ID</p>
<p>got to pages and deploy the application</p>
<p>bind the namespace in settings</p>
<p>then re-build the projkect</p>
<p>the url for api/images should return empty</p>
<p>and the homepage should be blank</p>
<p>SKIP
clone the lab 2 github repository</p>
<p>ensure that python is installed (write the steps for prereq)</p>
<p>open up the image upload file in your favorite editor</p>
<p>now we need some value
find this from when we created the KV namespace - if you forgot go to workes → kv namespaces and select IMAGES there shoudld be an ID there</p>
<p>kv_id = “ENTER YOU WORKERS KV NAMESPACE ID”</p>
<p>this can be easily found in the URL after “dash.cloudflare.com” that value is your account ID</p>
<p>kv_account_id = “ENTER YOUR CLOUDFLARE ACCOUNT ID”</p>
<p>we need to generate a new API token - lets do that</p>
<p>kv_token =”ENTER YOUR API TOKEN”</p>
<p>now that we have all of our values filled in lets take a look at the code -</p>
<p>the first part is uploading images to cloudfalre pages</p>
<blockquote>
<div><blockquote>
<div><p>since we are using a common images account</p>
</div></blockquote>
</div></blockquote>
<p>we only only have one image variant in this account but its important to note that you can define any number of variants just by creating a variant and changing the URL</p>
<p>once we do the upload we are then writing the image metadata to KV - this will be in the right format for our homepage to show the new images we upload</p>
<ul class="simple">
<li><p>lets go ahead and ruyn it!</p></li>
</ul>
<p>terrfici we should ahve gotten an aoutput that looks something like:
uploaded image gallery-images/cat1.jpeg and added KV metadata with status True</p>
<p>uploaded image gallery-images/cat2.jpeg and added KV metadata with status True</p>
<p>uploaded image gallery-images/cat3.jpeg and added KV metadata with status True</p>
<p>uploaded image gallery-images/pup1.jpeg and added KV metadata with status True</p>
<p>uploaded image gallery-images/pup2.jpeg and added KV metadata with status True</p>
<p>uploaded image gallery-images/pup3.jpeg and added KV metadata with status True</p>
<p>this means that our images were uploaded and the metadata was written it should look something like below!</p>
<p>Now if go back to our homepage and navigate to /api/images</p>
<p>this should return a full list of images
and our homepage should now have a full array!</p>
<p>AWESOME! congratulations you create a FULL stack application with Workers, KV, and IMAGES!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lab1.html" class="btn btn-neutral float-left" title="1. Cloudflare Pages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lab3.html" class="btn btn-neutral float-right" title="3. Cloudflare Workers (WIP)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Cloudflare.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>